library(peer)
setwd("/johnson/PEER/")
expr = read.csv("/johnson/PEER/UK.eQTL.gcrma.433.ComBat.Entrez.txt", row.names=1, sep="\t", header=TRUE)
covars = read.csv("/johnson/PEER/gwas.433.eQTL.csv", row.names=1, sep=",", header=TRUE )
texpr <- t(expr)
dim(texpr)
model = PEER()
PEER_setPhenoMean(model,as.matrix(texpr))
dim(PEER_getPhenoMean(model))
PEER_setNk(model,100)
PEER_getNk(model)
PEER_setCovariates(model, as.matrix(covars))
PEER_update(model)
texpr.factors = PEER_getX(model)
weights = PEER_getW(model)
precision = PEER_getAlpha(model)
residuals = PEER_getResiduals(model)
dim(texpr.factors)
peer.covars <- t(texpr.factors)
colnames(peer.covars) <- colnames(expr)
write.table(peer.covars, "UKpeerco.mar.433.covars.csv", quote=F, sep=",")
write.table(weights, "UKpeerco.mar.433.weights.csv", quote=F, sep=",")
write.table(precision, "UKpeerco.mar.433.precision.csv", quote=F, sep=",")
write.table(residuals, "UKpeerco.mar.433.residuals.csv", quote=F, sep=",")

png("UK.433.residuals.png",height=800,width=800)
plot(residuals)
dev.off()

pdf("UK.433.residuals.pdf")
plot(residuals)
dev.off()